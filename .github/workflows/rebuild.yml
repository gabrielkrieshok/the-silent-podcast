name: Trigger Netlify Build Daily

on:
  schedule:
    - cron: '0 6 * * *' # This will run at 6 AM UTC every day
  workflow_dispatch: # Allows manual trigger

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: '3.0.2' # or whichever version you're using
        bundler-cache: true

    - name: Update RubyGems to 3.3.22
      run: |
        gem update --system 3.3.22

    - name: Install dependencies
      run: |
        bundle install

    - name: Run Rake task to create today's post
      run: |
        bundle exec rake build

    - name: Trigger Netlify Deploy
      env:
        NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
      run: |
        curl -X POST -H "Content-Type: application/json" \
        -H "Authorization: Bearer $NETLIFY_AUTH_TOKEN" \
        -d '{}' \
        https://api.netlify.com/build_hooks/6686e6a33503705635e5a0fd
