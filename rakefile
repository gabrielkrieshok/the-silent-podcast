# coding: utf-8
require 'jekyll'
require 'date'
require 'active_support'
require 'active_support/core_ext'

# Rake task to create posts for the past 30 days
# command 'bundle exec rake create_posts'
task :create_posts do

  desc 'Create posts for the past 30 days if they do not exist'

  (0..29).each do |i|
    post_date = Date.today - i.days
    slug = "#{post_date}-episode"
    clean_date = post_date.strftime("%B %-d, %Y")

    file = File.join(
      File.dirname(__FILE__),
      '_posts',
      slug + '.md'
    )

    unless File.exist?(file)
      File.open(file, "w") do |f|
        f << <<~EOS.gsub(/^      /, '')
        ---
        title: "The Silent Podcast â€” #{clean_date}"
        date: #{post_date} 06:00:00 -0500
        file: "https://thesilentpodcast.s3.amazonaws.com/the-silent-podcast-episode-track.mp3"
        duration: "10:00"
        summary: "10 minutes of stillness for #{clean_date}."
        ---
        EOS
      end

      puts("Creating Post for #{clean_date}")
    else
      puts("Post for #{clean_date} already exists.")
    end
  end

  puts 'Finished creating posts for the past 30 days.'
end
